{% extends "base.html" %}
{% block title %}Register | Coop Station{% endblock %}

{% block content %}

<header class="nav-dark sticky-top">
  <div class="container py-3 d-flex align-items-center">

    <!-- Left -->
    <a class="d-flex align-items-center gap-2 text-decoration-none" href="{% url 'home' %}">
      <div class="logo-pill rounded-3 d-flex align-items-center justify-content-center text-white">
        <span class="fw-bold">CS</span>
      </div>
      <span class="fw-extrabold text-white fs-5" style="font-weight: 900;">Coop Station</span>
    </a>

    <!-- Center -->
    <div class="flex-grow-1 d-flex justify-content-center">
      <a href="{% url 'home' %}" class="nav-link-dark">
        Home
      </a>
    </div>

  </div>
</header>


<main class="min-vh-100 bg-soft py-5">

  <!-- Back Arrow -->
  <div class="container mb-3">
    <a href="{% url 'home' %}" class="back-arrow">
      ←
    </a>
  </div>

  <!-- Centered Card -->
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-9 col-lg-6 col-xl-5">

        <div class="card shadow-sm border-0 rounded-4">
          <div class="card-body p-4 p-md-5">

            <!-- Tabs -->
            <ul class="nav nav-pills mb-4 auth-tabs">
              <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100 fw-bold {% if active_tab == 'signup' %}active{% endif %}"
                  data-bs-toggle="pill" data-bs-target="#tab-signup" type="button" role="tab">
                  Signup
                </button>
              </li>

              <li class="nav-item flex-fill" role="presentation">
                <button class="nav-link w-100 fw-bold {% if active_tab == 'login' %}active{% endif %}"
                  data-bs-toggle="pill" data-bs-target="#tab-login" type="button" role="tab">
                  Login
                </button>
              </li>
            </ul>

            <div class="tab-content">
              {% if signup_form.errors %}
              <div class="alert alert-danger">
                <ul class="mb-0">
                  {% for field in signup_form %}
                  {% for error in field.errors %}
                  <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                  {% endfor %}
                  {% endfor %}
                  {% for error in signup_form.non_field_errors %}
                  <li>{{ error }}</li>
                  {% endfor %}
                </ul>
              </div>
              {% endif %}
              <div class="tab-content">

                <!-- Signup -->
                <div class="tab-pane fade {% if active_tab == 'signup' %}show active{% endif %}" id="tab-signup"
                  role="tabpanel">
                  <h1 class="h3 fw-bold mb-2">Create your account</h1>
                  <p class="text-secondary mb-4">Join Coop Station to discover co-op opportunities faster.</p>

                  {% if signup_form.errors and active_tab == 'signup' %}
                  <div class="alert alert-danger">
                    <ul class="mb-0">
                      {% for field in signup_form %}
                      {% for error in field.errors %}
                      <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                      {% endfor %}
                      {% endfor %}
                      {% for error in signup_form.non_field_errors %}
                      <li>{{ error }}</li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %}

                  <form method="post" action="{% url 'register' %}">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="signup">

                    <div class="mb-3">
                      <label class="form-label fw-semibold">Full Name</label>
                      <input class="form-control form-control-lg" name="full_name" placeholder="John Doe" required>
                    </div>

                    <div class="mb-3">
                      <label class="form-label fw-semibold">Username</label>
                      <input class="form-control form-control-lg" name="username" placeholder="johndoe123" required>
                    </div>

                    <div class="mb-3">
                      <label class="form-label fw-semibold">Email</label>
                      <input class="form-control form-control-lg" type="email" name="email"
                        placeholder="john@university.edu" required>
                    </div>

                    <div class="mb-3">
                      <label class="form-label fw-semibold">Password</label>
                      <input class="form-control form-control-lg" type="password" name="password1"
                        placeholder="••••••••" required>
                    </div>

                    <div class="mb-3">
                      <label class="form-label fw-semibold">Confirm Password</label>
                      <input class="form-control form-control-lg" type="password" name="password2"
                        placeholder="••••••••" required>
                    </div>

                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="terms" required>
                      <label class="form-check-label text-secondary" for="terms">
                        I agree to the Terms & Privacy Policy.
                      </label>
                    </div>

                    <button class="btn btn-cta w-100 py-3">Create Account</button>
                  </form>
                </div>

                <!-- Login -->
                <div class="tab-pane fade {% if active_tab == 'login' %}show active{% endif %}" id="tab-login"
                  role="tabpanel">
                  <h1 class="h3 fw-bold mb-2">Welcome back</h1>
                  <p class="text-secondary mb-4">Please enter your details to login.</p>

                  {% if login_form.errors and active_tab == 'login' %}
                  <div class="alert alert-danger">
                    <ul class="mb-0">
                      {% for field in login_form %}
                      {% for error in field.errors %}
                      <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                      {% endfor %}
                      {% endfor %}
                      {% for error in login_form.non_field_errors %}
                      <li>{{ error }}</li>
                      {% endfor %}
                    </ul>
                  </div>
                  {% endif %}

                  <form method="post" action="{% url 'register' %}">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="login">

                    <div class="mb-3">
                      <label class="form-label fw-semibold">Username or Email</label>
                      <input class="form-control form-control-lg" name="identifier"
                        placeholder="Enter your username or email" required>
                    </div>

                    <div class="mb-2 d-flex justify-content-between align-items-center">
                      <label class="form-label fw-semibold mb-0">Password</label>
                      <a class="text-brand small text-decoration-none" href="#">Forgot password?</a>
                    </div>

                    <div class="mb-3 position-relative">
                      <input id="loginPassword" class="form-control form-control-lg pe-5" type="password"
                        name="password" placeholder="Enter your password" required>

                      <!-- Eye icon -->
                      <span onclick="togglePassword()" style="
                          position:absolute;
                          right:16px;
                          top:50%;
                          transform:translateY(-50%);
                          cursor:pointer;
                          color:#6c757d;
                        ">
                        <i id="eyeIcon" class="bi bi-eye"></i>
                      </span>
                    </div>

                    <div class="form-check mb-3">
                      <input class="form-check-input" type="checkbox" id="remember">
                      <label class="form-check-label text-secondary" for="remember">Remember me</label>
                    </div>

                    <button class="btn btn-login-orange w-100 py-3">Login</button>
                  </form>
                </div>

              </div>


              <p class="text-center text-secondary small mt-4 mb-0">
                © 2026 Coop Station. All rights reserved.
              </p>

            </div>
            <div class="d-flex justify-content-center gap-4 mt-4 small text-secondary flex-wrap">
              <div>✓ Verified companies</div>
              <div>✓ AI driven search</div>
              <div>✓ Free for students</div>
            </div>
          </div>
        </div>
</main>

<!-- Bootstrap JS (required for tabs) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function togglePassword() {
    const input = document.getElementById("loginPassword");
    const icon = document.getElementById("eyeIcon");

    if (input.type === "password") {
      input.type = "text";
      icon.classList.remove("bi-eye");
      icon.classList.add("bi-eye-slash");
    } else {
      input.type = "password";
      icon.classList.remove("bi-eye-slash");
      icon.classList.add("bi-eye");
    }
  }
</script>

{% endblock %}