{# accounts/templates/pages/partials/_major_filter.html #}

{#
This partial is included INSIDE the Major dropdown menu list-group.
It must NOT contain another dropdown/button/menu.

Expected context:
- categories_with_counts: [{id, name, count, selected}, ...]
- selected_region / selected_city (optional)
#}

<form method="get" action="{% url 'opportunities' %}" id="majorsForm" class="w-100">
    {# Keep other filters #}
    {% if selected_region %}<input type="hidden" name="region" value="{{ selected_region }}">{% endif %}
    {% if selected_city %}<input type="hidden" name="city" value="{{ selected_city }}">{% endif %}

    {# Reset pagination when filters change #}
    <input type="hidden" name="page" value="1">

    {% for c in categories_with_counts %}
    <label class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
        style="border:0; cursor:pointer;">
        <span class="d-flex align-items-center gap-2">
            <span class="form-check m-0">
                <input class="form-check-input" type="checkbox" name="category" value="{{ c.id }}" {% if c.selected
                    %}checked="checked" {% endfor %}>
            </span>
            <span>{{ c.name }}</span>
        </span>
        <span class="text-primary fw-semibold">{{ c.count }}</span>
    </label>

    <div class="p-2 text-secondary">No categories found.</div>

</form>

<script>
    // Auto-apply majors filter when user checks/unchecks
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("majorsForm");
        if (!form) return;

        const boxes = form.querySelectorAll("input[type='checkbox'][name='category']");
        boxes.forEach(cb => {
            cb.addEventListener("change", () => {
                form.submit();
            });
        });
    });
</script>